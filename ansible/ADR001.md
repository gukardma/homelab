# S3 Backend Bucket Deployment Method for Terraform

Status: `Proposed`

Date: `2025-10-22`

## Context and Problem Statement

The main Terraform project requires a MinIO S3 bucket to store its state (`terraform.tfstate`). I need a reliable and reproducible method for creating this bucket before Terraform can use it, but this creates a "chicken or the egg" problem: Terraform cannot initialize its backend until the bucket exists, but I want to use IaC to create the bucket in the first place. How do I create the bucket?

## Decision Drivers

* The solution should use IaC making it reproducible and version controlled.
* Chosen method shouldn't depend on the main Terraform project's state (what I want to store).
* The bucket's configuration should be manageable over time.

## Considered Options

* **Manual:** Deploy with the MinIO web UI or CLI.
* **Stateful:** Use Terraform with a MinIO provider to create the bucket.
* **Stateless:** Use an Ansible playbook with a MinIO module to create the bucket.

## Pros and Cons of the Options

### Option 1: Manual Deployment

* Good because it's the fastest and easiest method.
* Good because it avoids circular dependency.
* Bad because it's not version controlled.
* Bad because of potential of human error (forgetting to version bucket, etc.). 

### Option 2: Two Step Terraform Deployment

* Good because of IaC.
* Good because it builds on the main Terraform project and does not add the complexity of new tools.
* Bad because it requires two project deployment process: Create a "bootstrap" Terraform project that uses a local state file. This project's only job is to create the S3 bucket to be used by the "main" Terraform project
* Bad because the bootstrap state file is stored locally

### Option 3: Ansible Deployment

* Good because of IaC
* Good because Ansible is stateless and does not suffer from the circular dependency problem Terraform may have.
* Bad because its a more complicated workflow with a new tool added to the infra stack (although a good learning experience)

## Decision Outcome

Chosen option: **"Ansible Deployment"**, because it has the best balance of practicality and IaC principles.

This approach keeps the infrastructure defined as code. While it introduces a new tool, Ansible, it resolves the circular dependency without the added complexity of managing a separate local Terraform state. This allows the main Terraform project to stay clean.

## Links

* ADR Source: [joelparkerhenderson/architecture-decision-record](https://github.com/joelparkerhenderson/architecture-decision-record/blob/main/locales/en/templates/decision-record-template-of-the-madr-project/index.md)